(()=>{"use strict";var e=["inputSelector","submitButtonSelector","inactiveButtonClass"];function t(e,t){if(null==e)return{};var n,o,r=function(e,t){if(null==e)return{};var n,o,r={},c=Object.keys(e);for(o=0;o<c.length;o++)n=c[o],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(e);for(o=0;o<c.length;o++)n=c[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var n={inputErrorClass:"popup__input_error",inputErrorActiveClass:"popup__input-error_active",inactiveButtonClass:"popup__button-save_inactive",inputSelector:".popup__input",submitButtonSelector:".popup__button-save",formSelector:".popup__container-form"},o=function(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.disabled=!1,t.classList.remove(n)):(t.disabled=!0,t.classList.add(n))};function r(e,t){e===t&&"Сохранение..."===e.textContent?e.textContent="Создать":"Сохранение..."===e.textContent?e.textContent="Сохранить":e.textContent="Сохранение..."}function c(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}function i(e){console.log(e)}var a=document.querySelector(".popup_card-zoom"),u=a.querySelector(".popup__button-close"),s=a.querySelector(".popup__image"),l=a.querySelector(".popup__caption");function d(e){e.classList.add("popup_opened"),document.addEventListener("keydown",v)}function p(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",v)}function f(e){e.currentTarget===e.target&&p(e.currentTarget)}function v(e){"Escape"===e.key&&p(document.querySelector(".popup_opened"))}function m(e){s.src=e.currentTarget.src,s.alt=e.currentTarget.alt,l.textContent=e.currentTarget.nextElementSibling.textContent,d(a)}var _=fetch("https://nomoreparties.co/v1/plus-cohort-28/users/me",{headers:{authorization:"ef5df4b1-0580-4314-b10f-2fd4a208efc0"}}).then(c),h=fetch("https://nomoreparties.co/v1/plus-cohort-28/cards",{headers:{authorization:"ef5df4b1-0580-4314-b10f-2fd4a208efc0"}}).then(c),y=document.querySelector("#card-template").content,S=document.querySelector(".cards__links");function b(e,t){e.textContent=t}function E(e,t,n,o,r,a,u){var s=y.querySelector(".card").cloneNode(!0),l=s.querySelector(".card__like-button"),d=s.querySelector(".card__trash-button"),p=s.querySelector(".card__image"),f=s.querySelector(".card__likes");return b(f,o),l.addEventListener("click",(function(){!function(e,t,n){n.classList.toggle("card__like-button_active"),n.classList.contains("card__like-button_active")?function(e){return fetch("https://nomoreparties.co/v1/plus-cohort-28/cards/likes/".concat(e),{method:"PUT",headers:{authorization:"ef5df4b1-0580-4314-b10f-2fd4a208efc0"}}).then(c)}(e).then((function(e){b(t,e.likes.length)})).catch(i):function(e){return fetch("https://nomoreparties.co/v1/plus-cohort-28/cards/likes/".concat(e),{method:"DELETE",headers:{authorization:"ef5df4b1-0580-4314-b10f-2fd4a208efc0"}}).then(c)}(e).then((function(e){b(t,e.likes.length)})).catch(i)}(r,f,l)})),a!==u?d.style.display="none":d.addEventListener("click",(function(){(function(e){return fetch("https://nomoreparties.co/v1/plus-cohort-28/cards/".concat(e),{method:"DELETE",headers:{authorization:"ef5df4b1-0580-4314-b10f-2fd4a208efc0"}}).then(c)})(r).then(function(e){document.getElementById(e).remove()}(r)).catch(i)})),p.addEventListener("click",(function(e){m(e)})),s.querySelector(".card__caption").textContent=e,p.src=t,p.alt=n,s.id=r,s}function k(e,t){e===t?S.prepend(e):S.append(e)}var q,L,C,g=document.querySelector(".popup_profile-edit"),x=document.querySelector(".popup_card-add"),T=document.querySelector(".popup_ava-edit"),O=document.querySelector(".profile__edit-button"),j=document.querySelector(".profile__add-button"),w=g.querySelector(".popup__button-close"),z=x.querySelector(".popup__button-close"),A=T.querySelector(".popup__button-close"),B=g.querySelector(".popup__container-form"),P=x.querySelector(".popup__container-form"),D=T.querySelector(".popup__container-form"),N=document.querySelector("#name"),I=document.querySelector("#image-link-ava"),J=document.querySelector("#description"),M=document.querySelector("#image-name"),H=document.querySelector("#image-link"),V=B.querySelector(".popup__button-save"),U=D.querySelector(".popup__button-save"),F=P.querySelector(".popup__button-save"),G=n.inactiveButtonClass,K=document.querySelector(".profile__name"),Q=document.querySelector(".profile__description"),R=document.querySelector(".profile__avatar");Promise.all([_,h]).then((function(e){console.log(e[1]);var t,n=e[0]._id;t=e[0],K.textContent=t.name,Q.textContent=t.about,R.src=t.avatar,function(e,t){e.forEach((function(e){var n=e.likes.length;k(E(e.name,e.link,e.name,n,e._id,e.owner._id,t)),e.likes.forEach((function(n){n._id===t&&document.getElementById(e._id).querySelector(".card__like-button").classList.add("card__like-button_active")}))}))}(e[1],n),console.log(e[1])})).catch(i),L=(q=n).formSelector,C=t(q,["formSelector"]),Array.from(document.querySelectorAll(L)).forEach((function(n){!function(n,r){var c=r.inputSelector,i=r.submitButtonSelector,a=r.inactiveButtonClass,u=t(r,e),s=Array.from(n.querySelectorAll(c)),l=n.querySelector(i);o(s,l,a),s.forEach((function(e){e.addEventListener("input",(function(){(function(e,t,n){var o=Object.assign({},(function(e){if(null==e)throw new TypeError("Cannot destructure "+e)}(n),n));t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?function(e,t,n){var o=n.inputErrorClass,r=n.inputErrorActiveClass,c=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(o),c.classList.remove(r),c.textContent=""}(e,t,o):function(e,t,n,o){var r=o.inputErrorClass,c=o.inputErrorActiveClass,i=e.querySelector(".".concat(t.id,"-error"));t.classList.add(r),i.textContent=n,i.classList.add(c)}(e,t,t.validationMessage,o)})(n,e,u),o(s,l,a)}))}))}(n,C)})),O.addEventListener("click",(function(){N.value=K.textContent,J.value=Q.textContent,o([N,J],V,G),d(g)})),R.addEventListener("click",(function(){o([I],U,G),d(T)})),j.addEventListener("click",(function(){o([M,H],F,G),d(x)})),w.addEventListener("click",(function(){p(g)})),A.addEventListener("click",(function(){p(T)})),z.addEventListener("click",(function(){p(x)})),u.addEventListener("click",(function(){p(a)})),g.addEventListener("click",f),T.addEventListener("click",f),x.addEventListener("click",f),a.addEventListener("click",f),B.addEventListener("submit",(function(e){var t,n;e.preventDefault(),(t=K.textContent=N.value,n=Q.textContent=J.value,fetch("https://nomoreparties.co/v1/plus-cohort-28/users/me",{method:"PATCH",headers:{authorization:"ef5df4b1-0580-4314-b10f-2fd4a208efc0","Content-Type":"application/json"},body:JSON.stringify({name:t,about:n})}).then(c)).then((function(){return p(g)})).then((function(){return r(V)})).catch(i)})),D.addEventListener("submit",(function(e){var t;e.preventDefault(),(t=R.src=I.value,fetch("https://nomoreparties.co/v1/plus-cohort-28/users/me/avatar",{method:"PATCH",headers:{authorization:"ef5df4b1-0580-4314-b10f-2fd4a208efc0","Content-Type":"application/json"},body:JSON.stringify({avatar:t})}).then(c)).then((function(){return p(T)})).then((function(){return r(U)})).catch(i)})),P.addEventListener("submit",(function(e){var t,n;e.preventDefault(),(t=M.value,n=H.value,fetch("https://nomoreparties.co/v1/plus-cohort-28/cards",{method:"POST",headers:{authorization:"ef5df4b1-0580-4314-b10f-2fd4a208efc0","Content-Type":"application/json"},body:JSON.stringify({name:t,link:n})}).then(c)).then((function(e){var t=e.likes.length,n=E(e.name,e.link,e.name,t,e._id,e.owner._id,e.owner._id);k(n,n),p(x)})).then((function(){return r(F,F)})).catch(i),e.target.reset()})),V.addEventListener("click",(function(){r(V)})),U.addEventListener("click",(function(){r(U)})),F.addEventListener("click",(function(){r(F,F)}))})();