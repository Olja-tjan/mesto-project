(()=>{"use strict";var e=["inputSelector","submitButtonSelector","inactiveButtonClass"];function t(e,t){if(null==e)return{};var n,o,r=function(e,t){if(null==e)return{};var n,o,r={},c=Object.keys(e);for(o=0;o<c.length;o++)n=c[o],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(e);for(o=0;o<c.length;o++)n=c[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var n={inputErrorClass:"popup__input_error",inputErrorActiveClass:"popup__input-error_active",inactiveButtonClass:"popup__button-save_inactive",inputSelector:".popup__input",submitButtonSelector:".popup__button-save",formSelector:".popup__container-form"},o=function(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.disabled=!1,t.classList.remove(n)):(t.disabled=!0,t.classList.add(n))},r=document.querySelector(".popup_card-zoom"),c=r.querySelector(".popup__button-close"),i=r.querySelector(".popup__image"),a=r.querySelector(".popup__caption");function u(e){e.classList.add("popup_opened"),document.addEventListener("keydown",d)}function s(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",d)}function l(e){e.currentTarget===e.target&&s(e.currentTarget)}function d(e){"Escape"===e.key&&s(document.querySelector(".popup_opened"))}function p(e){i.src=e.currentTarget.src,i.alt=e.currentTarget.alt,a.textContent=e.currentTarget.nextElementSibling.textContent,u(r)}var f=document.querySelector("#card-template").content,m=document.querySelector(".cards__links");function v(e,t){e.textContent=t}function _(e,t,n,o,r,c,i){var a=f.querySelector(".card").cloneNode(!0),u=a.querySelector(".card__like-button"),s=a.querySelector(".card__trash-button"),l=a.querySelector(".card__image"),d=a.querySelector(".card__likes");return v(d,o),u.addEventListener("click",(function(){!function(e,t,n){n.classList.toggle("card__like-button_active"),n.classList.contains("card__like-button_active")?function(e,t){fetch("https://nomoreparties.co/v1/plus-cohort-28/cards/likes/".concat(e),{method:"PUT",headers:{authorization:"ef5df4b1-0580-4314-b10f-2fd4a208efc0"}}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){v(t,e.likes.length)}))}(e,t):function(e,t){fetch("https://nomoreparties.co/v1/plus-cohort-28/cards/likes/".concat(e),{method:"DELETE",headers:{authorization:"ef5df4b1-0580-4314-b10f-2fd4a208efc0"}}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){v(t,e.likes.length)}))}(e,t)}(r,d,u)})),c!==i?s.style.display="none":s.addEventListener("click",(function(){!function(e){fetch("https://nomoreparties.co/v1/plus-cohort-28/cards/".concat(e),{method:"DELETE",headers:{authorization:"ef5df4b1-0580-4314-b10f-2fd4a208efc0"}}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})),function(e){document.getElementById(e).remove()}(e)}(r)})),l.addEventListener("click",(function(e){p(e)})),a.querySelector(".card__caption").textContent=e,a.querySelector(".card__image").src=t,a.querySelector(".card__image").alt=n,a.id=r,a}function y(e){m.prepend(e)}var h=document.querySelector(".profile__name"),S=document.querySelector(".profile__description"),b=document.querySelector(".profile__avatar"),k=new Promise((function(e,t){fetch("https://nomoreparties.co/v1/plus-cohort-28/users/me",{headers:{authorization:"ef5df4b1-0580-4314-b10f-2fd4a208efc0"}}).then((function(n){e(n.json()),t("Ошибка: ".concat(n.status))}))})),q=new Promise((function(e,t){fetch("https://nomoreparties.co/v1/plus-cohort-28/cards",{headers:{authorization:"ef5df4b1-0580-4314-b10f-2fd4a208efc0"}}).then((function(n){e(n.json()),t("Ошибка: ".concat(n.status))}))}));Promise.all([k,q]).then((function(e){var t=e[0]._id;h.textContent=e[0].name,S.textContent=e[0].about,b.src=e[0].avatar,e[1].forEach((function(e){var n=e.likes.length;y(_(e.name,e.link,e.name,n,e._id,e.owner._id,t)),e.likes.forEach((function(n){n._id===t&&document.getElementById(e._id).querySelector(".card__like-button").classList.add("card__like-button_active")}))}))}));var E,g,C,L=document.querySelector(".popup_profile-edit"),j=document.querySelector(".popup_card-add"),x=document.querySelector(".popup_ava-edit"),P=document.querySelector(".profile__edit-button"),T=document.querySelector(".profile__add-button"),O=L.querySelector(".popup__button-close"),w=j.querySelector(".popup__button-close"),z=x.querySelector(".popup__button-close"),A=L.querySelector(".popup__container-form"),B=j.querySelector(".popup__container-form"),D=x.querySelector(".popup__container-form"),N=document.querySelector("#name"),I=document.querySelector("#image-link-ava"),J=document.querySelector("#description"),M=document.querySelector("#image-name"),H=document.querySelector("#image-link"),V=A.querySelector(".popup__button-save"),U=D.querySelector(".popup__button-save"),F=B.querySelector(".popup__button-save"),G=n.inactiveButtonClass;function K(e){e.textContent="Сохранение..."}function Q(e){e.textContent="Сохранить"}g=(E=n).formSelector,C=t(E,["formSelector"]),Array.from(document.querySelectorAll(g)).forEach((function(n){!function(n,r){var c=r.inputSelector,i=r.submitButtonSelector,a=r.inactiveButtonClass,u=t(r,e),s=Array.from(n.querySelectorAll(c)),l=n.querySelector(i);o(s,l,a),s.forEach((function(e){e.addEventListener("input",(function(){(function(e,t,n){var o=Object.assign({},(function(e){if(null==e)throw new TypeError("Cannot destructure "+e)}(n),n));t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?function(e,t,n){var o=n.inputErrorClass,r=n.inputErrorActiveClass,c=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(o),c.classList.remove(r),c.textContent=""}(e,t,o):function(e,t,n,o){var r=o.inputErrorClass,c=o.inputErrorActiveClass,i=e.querySelector(".".concat(t.id,"-error"));t.classList.add(r),i.textContent=n,i.classList.add(c)}(e,t,t.validationMessage,o)})(n,e,u),o(s,l,a)}))}))}(n,C)})),P.addEventListener("click",(function(){N.value=h.textContent,J.value=S.textContent,o([N,J],V,G),u(L)})),b.addEventListener("click",(function(){o([I],U,G),u(x)})),T.addEventListener("click",(function(){o([M,H],F,G),u(j)})),O.addEventListener("click",(function(){s(L)})),z.addEventListener("click",(function(){s(x)})),w.addEventListener("click",(function(){s(j)})),c.addEventListener("click",(function(){s(r)})),L.addEventListener("click",l),x.addEventListener("click",l),j.addEventListener("click",l),r.addEventListener("click",l),A.addEventListener("submit",(function(e){var t,n;e.preventDefault(),K(V),t=h.textContent=N.value,n=S.textContent=J.value,fetch("https://nomoreparties.co/v1/plus-cohort-28/users/me",{method:"PATCH",headers:{authorization:"ef5df4b1-0580-4314-b10f-2fd4a208efc0","Content-Type":"application/json"},body:JSON.stringify({name:t,about:n})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})),s(L),Q(V)})),D.addEventListener("submit",(function(e){var t;e.preventDefault(),K(U),t=b.src=I.value,fetch("https://nomoreparties.co/v1/plus-cohort-28/users/me/avatar",{method:"PATCH",headers:{authorization:"ef5df4b1-0580-4314-b10f-2fd4a208efc0","Content-Type":"application/json"},body:JSON.stringify({avatar:t})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})),s(x),Q(U)})),B.addEventListener("submit",(function(e){var t,n;e.preventDefault(),K(F),t=M.value,n=H.value,fetch("https://nomoreparties.co/v1/plus-cohort-28/cards",{method:"POST",headers:{authorization:"ef5df4b1-0580-4314-b10f-2fd4a208efc0","Content-Type":"application/json"},body:JSON.stringify({name:t,link:n})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){var t=e.likes.length;y(_(e.name,e.link,e.name,t,e._id,e.owner._id,e.owner._id))})),s(j),F.textContent="Создать",e.target.reset()}))})();